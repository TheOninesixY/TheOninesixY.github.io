steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Setup Node.js
    uses: actions/setup-node@v4
    with:
      node-version: '18'

  - name: Install dependencies
    run: npm ci

  - name: Build documentation
    run: |
      # 优先使用 package.json 中的 docs:build 或 build 脚本，否则使用 vitepress CLI
      if npm run | grep -q 'docs:build'; then
        echo "Running npm run docs:build"
        npm run docs:build
      elif npm run | grep -q 'build'; then
        echo "Running npm run build"
        npm run build
      else
        echo "No build script found, running npx vitepress build docs"
        npx vitepress build docs
      fi

  - name: Debug: list generated files (for troubleshooting)
    run: |
      echo "工作目录："
      pwd
      echo ""
      echo "项目根目录 listing:"
      ls -la
      echo ""
      echo "docs 目录 listing:"
      ls -la docs || true
      echo ""
      echo "docs/.vitepress 目录 listing:"
      ls -la docs/.vitepress || true
      echo ""
      echo "docs/.vitepress/dist 目录 listing:"
      ls -la docs/.vitepress/dist || true

  - name: Configure Pages
    uses: actions/configure-pages@v3

  - name: Upload Pages artifact
    # 使用 upload-pages-artifact（会在后续 deploy-pages 中被使用）
    uses: actions/upload-pages-artifact@v1
    with:
      # 保持和 VitePress 默认输出同步：docs/.vitepress/dist
      path: docs/.vitepress/dist

  - name: Deploy to GitHub Pages
    uses: actions/deploy-pages@v1
